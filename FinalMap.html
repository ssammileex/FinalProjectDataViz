<!DOCTYPE html>
<!--
  Course: DATA 300L 111 Spring 2018
  Author: Samantha Errico and Allison Moshier
  Email: Samantha.errico1@marist.edu
  CWID: 200-57-156
  Assignment: 5
-->
<html lang="en">
<head>
  	<meta charset="utf-8"/>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>Crabs</title>

   <style>
        body {
            position: absolute;
            font-family: "Proxima Nova", "Montserrat", sans-serif;
        }
        h1, h2 {
            position: absolute;
            left: 10px;
            font-size: 1.3em;
            font-weight: 100;
        }
        h2 {
            top: 30px;
            font-size: 1em;
        }
        .hover {
            fill: yellow;   
        }
        #sliderContainer {
            text-align: center;
            position: relative;
            top: 600px;
        }

        /* Legend Font Style */
        body {
            font: 11px sans-serif;
            background-color: #ffffff;
        }
                
        /* Legend Position Style */
        .legend {
            position:absolute;
            left:20px;
            top:30px;
        }

        .axis text {
            font: 10px sans-serif;
        }

        .axis line, .axis path {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
    </style>

</head>

<body>
	<h1>Map of the United States: Crime Rate by State</h1>

	<script>
		
		//Define height and width
		var w = 1125;
        var h = 520;

		//define projection
		var projection = d3.geoAlbersUsa()
							.translate([w/2, h/2])
							.scale([1000]);


		//define path
		var path = d3.geoPath()
					 .projection(projection);

		//create color gradient
		//var color = d3.scaleOrdinal(d3.schemeCategory10);

		var color = d3.scaleQuantize()
					.domain([20000,170000,320000,470000,620000,770000,920000,1070000,1220000,1370000,1520000,1670000,1820000,1970000,2120000,2270000,2420000])
					.range(["#ffe6e6","#ffcccc","#ffb3b3","ff9999","#ff8080","#ff6666","#ff4d4d","#ff3333","#ff1a1a", "#ff0000","#e60000", "#cc0000", "#b30000", "#990000", "800000", "#660000", "#4d0000" ]);

 
		//var formatComma = d3.format(".1f");
		var tooltip = d3.select("body")
                        .append("div")
                        .style("position", "absolute")
                        .style("z-index", "10")
                        .style("visibility", "hidden")
                        .style("color", "white")
                        .style("padding", "8px")
                        .style("background-color", "rgba(0, 0, 0, 0.75)")
                        .style("border-radius", "6px")
                        .style("font", "12px sans-serif")
                        .text("tooltip");

		d3.csv("usCrimes.csv", function(data){
		  	//data.Total += parseInt(data.Total)
		  	
		var min = d3.min(data, function(d) { return parseInt(d.Total);});
		var max = d3.max(data, function(d) { return parseInt(d.Total);});
		
        
		color.domain([min, max]);  	
		  	console.log(min);
		  	console.log(max);

		d3.json("us-states.json", function(json){
		  for(var i = 0; i < data.length; i++){
		  	var dataState = data[i].State;
		  	console.log(data[i].Total);
		  	var dataTotal = parseInt(data[i].Total);


		  	for(var j = 0; j < json.features.length; j++){
		  		var jsonState = json.features[j].properties.name;
		  			if(dataState == jsonState){
		  				json.features[j].properties.Total = dataTotal;
		  				break;
		  			}
		  	}
		  }

		  //Create SVG element
          var svg = d3.select("body")
                .append("svg")
                .attr("width", w)
                .attr("height", h)
                .attr("style", "outline: thin solid black;");

			svg.selectAll("path")
				.data(json.features)
				.enter()
				.append("path")
				.attr("d", path)
				.style("fill", function(d){
					var value = d.properties.Total;
						if(value){
							return color(value);
						}else{
							return "black";
						}
					});

             // add a legend
        var width = 140, height = 300;

        var key = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("class", "legend");

        var legend = key.append("defs")
            .append("svg:linearGradient")
            .attr("id", "gradient")
            .attr("x1", "100%")
            .attr("y1", "0%")
            .attr("x2", "100%")
            .attr("y2", "100%")
            .attr("spreadMethod", "pad");

        legend.append("stop")
            .attr("offset", "0%")
            .attr("stop-color", "#4d0000")
            .attr("stop-opacity", 1);
            
        legend.append("stop")
            .attr("offset", "100%")
            .attr("stop-color", "#ffe6e6")
            .attr("stop-opacity", 1);

        key.append("rect")
            .attr("width", width - 100)
            .attr("height", height)
            .style("fill", "url(#gradient)")
            .attr("transform", "translate(0,10)");

        var y = d3.scaleLinear()
            .range([height, 0])
            .domain([min, max]);

        var yAxis = d3.axisRight(y);

        key.append("g")
            .attr("class", "y axis")
            .attr("transform", "translate(41, 10)")
            .call(yAxis)


			// draw legend
            // var legend = svg.selectAll(".legend")
            //     .data(["20000,170000,320000,470000,620000,770000,920000,1070000,1220000,1370000,1520000,1670000,1820000,1970000,2120000,2270000,2420000"])
            //   .enter().append("g")
            //     .attr("class", "legend")
            //     .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            // // draw legend colored rectangles
            // legend.append("rect")
            //   .attr("id", "legendRect")
            //     .attr("x",  190)
            //     .attr("y", 43)
            //     .attr("width", 18)
            //     .attr("height", 18)
            //     .attr("fill", function(d){
            //       if (d <= "20000"){
            //         return "#ffe6e6";
            //       }else if (d <= "170000"){
            //         return "#ffcccc";
            //       }else if(d <= "320000"){
            //         return "#ffb3b3"
            //       }else if(d <= "470000"){
            //       	return "ff9999";
            //       }else if(d <= "620000"){
            //       	return "#ff8080";
            //       }else if(d <= "770000"){
            //       	return "#ff6666";
            //       }else if(d <= "920000"){
            //       	return "#ff4d4d";
            //       }else if(d <= "1070000"){
            //       	return "#ff3333";
            //       }else if(d <= "1220000"){
            //       	return "#ff1a1a";
            //       }else if(d <="1370000"){
            //       	return "#ff0000";
            //       }else if(d <= "1520000"){
            //       	return "#e60000";
            //       }else if(d <= "1670000"){
            //       	return "#cc0000";
            //       }else if(d <= "1820000"){
            //       	return "#b30000";
            //       }else if(d <= "1970000"){
            //       	return "#990000";
            //       }else if(d <= "2120000"){
            //       	return "800000";
            //       }else if(d ="2270000"){
            //       	return "#660000";
            //       }else{
            //       	return "#4d0000";
            //       }
            //      });

			// svg.selectAll("path")
			// 	.data(json.features)
			// 	.enter()
			// 	.append("path")
			// 	.attr("d", path);

			// svg.append("path")
   //              .attr("r", function(d) { return d.r; })
   //              .style("fill", function(d) { return color(d.package); })
   //              .on("mouseover", function(d) {
   //                        tooltip.text(d.State + ": " + format(d.Total));
   //                        tooltip.style("visibility", "visible");
   //              })
   //              .on("mousemove", function() {
   //                    return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
   //              })
   //              .on("mouseout", function(){return tooltip.style("visibility", "hidden");});

		});
	});

	</script>

</body>
</html>

